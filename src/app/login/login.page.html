<ion-content class="login-page">
    <div class="login-page-title">
        <h1>OneCart</h1>
    </div>

    <p class="p-larger fw-light ta-center login-instructions">
        Use your phone Number to get a <br />One Time Password to
        <b>Login</b> or
        <b>Register</b>
    </p>

    <div #loginFormBox class="login-form" [@fadeIn]>
        <form [formGroup]="loginFormGroup" (ngSubmit)="submitPhoneNumber()">
            <app-input
                inputLabel="Phone Number"
                type="tel"
                inputmode="tel"
                autocomplete="tel"
                maxlength="14"
                placeholder="+1 (000) 123 4567"
                formControlName="phoneNumber"
                [disabled]="awaitingVerificationCode$ | async"
                [formControl]="phoneNumberFormControl"
                [pattern]="phoneNumberRegex"
            >
                <div *ngIf="phoneNumberFormControl.errors?.required">
                    Please Enter a Phone Number
                </div>

                <div *ngIf="phoneNumberFormControl.errors?.pattern">
                    Please Enter a Valid Phone Number
                </div>
            </app-input>

            <div
                class="spinner-container"
                *ngIf="!(recaptchaRendered$ | async)"
            >
                <ion-spinner></ion-spinner>
            </div>

            <div
                [hidden]="awaitingVerificationCode$ | async"
                id="recaptcha-container"
            ></div>

            <app-button
                id="submit-phone-login"
                *ngIf="!(awaitingVerificationCode$ | async)"
                expand="block"
                type="submit"
                [submitting]="submittingPhoneNumber"
                [disabled]="!(recaptchaRendered$ | async)"
            >
                Send Code
            </app-button>

            <ng-container *ngIf="awaitingVerificationCode$ | async">
                <app-input
                    inputLabel="Enter Verification Code"
                    type="text"
                    autocomplete="one-time-code"
                    maxlength="6"
                    placeholder="Code"
                    formControlName="verificationCode"
                    [formControl]="verificationCodeFormControl"
                    [pattern]="verificationCodeRegex"
                >
                    <div
                        *ngIf="
                            verificationCodeFormControl.errors?.required ||
                            verificationCodeFormControl.errors?.pattern
                        "
                    >
                        Please Enter your 6 Digit Verification Code
                    </div>
                    <ng-container
                        *ngIf="!(
                            verificationCodeFormControl.errors?.required 
                            || verificationCodeFormControl.errors?.pattern
                        )"
                    >
                        <div
                            *ngIf="(authenticationError$ | async) === authErrorType.InvalidCode"
                        >
                            Invalid code, please try again
                        </div>
                        <div
                            *ngIf="(authenticationError$ | async) && (authenticationError$ | async) !== authErrorType.InvalidCode"
                        >
                            There was an error logging in, please try again
                        </div>
                    </ng-container>
                </app-input>
            </ng-container>
            <app-button
                *ngIf="awaitingVerificationCode$ | async"
                class="login-button"
                expand="block"
                [submitting]="submittingVerificationCode"
                (buttonClick)="submitVerificationCode()"
            >
                Login
            </app-button>
            <app-button
                *ngIf="awaitingVerificationCode$ | async"
                expand="block"
                color="secondary"
                fill="clear"
                (buttonClick)="cancelVerificationCode()"
            >
                Change Number and Resend
            </app-button>
        </form>
    </div>
</ion-content>
